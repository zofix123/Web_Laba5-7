<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div style="text-align: right; color: gray; font-size: 0.9em;">
  Текущее время сервера: <span id="serverTime" th:text="${serverTime}"></span>
</div>

<h2>Смена пароля</h2>

<div th:if="${session.user == null}">
  <p>Вы не авторизованы</p>
  <a th:href="@{/users/login}">Войти</a>
</div>

<div th:if="${session.user != null}">
  <p th:if="${error}" th:text="${error}" style="color:red"></p>
  <p th:if="${success}" th:text="${success}" style="color:green"></p>

  <form th:action="@{/users/change-password}" method="post" onsubmit="return validatePassword()">
    <input type="hidden" name="userId" th:value="${session.user.id}">

    <label>Старый пароль:</label><br>
    <input type="password" name="oldPassword" required><br><br>

    <label>Новый пароль (мин. 4 символа):</label><br>
    <input type="password" id="newPassword" name="newPassword"
           placeholder="Минимум 4 символа" required
           minlength="4" oninput="checkPasswordStrength()"><br>
    <div id="password-strength" style="font-size: 0.8em; margin-bottom: 5px;"></div>

    <label>Подтвердите новый пароль:</label><br>
    <input type="password" id="confirmNewPassword" name="confirmNewPassword"
           placeholder="Повторите новый пароль" required
           minlength="4"><br>
    <div id="password-match" style="font-size: 0.8em; margin-bottom: 10px;"></div>

    <button type="submit">Сменить пароль</button>
  </form>

  <br><br>
  <a th:href="@{/profile}">Вернуться в профиль</a>
</div>
<script th:src="@{/js/password_check.js}"></script>
<script th:src="@{/js/time_fetcher.js}"></script>
</body>
</html>