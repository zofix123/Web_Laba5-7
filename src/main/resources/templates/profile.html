<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–∞–π—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤ - –ø—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body>
<div class="page">
    <header class="header">
        <div class="header__inner">
            <div></div>

            <div class="header__brand">
                <a th:href="@{/main}">–°–ê–ô–¢ –ó–ù–ê–ö–û–ú–°–¢–í</a>
            </div>

            <nav class="header__nav">
                <a th:href="@{/news}">–ù–û–í–û–°–¢–ò</a>
                <a th:href="@{/profile}">–ü–†–û–§–ò–õ–¨</a>
            </nav>
        </div>
    </header>

    <div class="server-time">
        –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞:
        <span id="serverTime" th:text="${serverTime}">‚Äî</span>
    </div>

    <main class="profile">
        <!-- –ù–ï –ê–í–¢–û–†–ò–ó–û–í–ê–ù -->
        <section class="box status" th:if="${session.user == null}">
            <div class="status__text">–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã</div>
            <div class="status__text">
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, <a class="link" th:href="@{/users/login}">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏
                <a class="link" th:href="@{/users/register}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>.
            </div>

            <div class="status__actions">
                <a class="button" th:href="@{/users/login}">–í—Ö–æ–¥</a>
                <a class="button" th:href="@{/users/register}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </section>

        <!-- –ê–í–¢–û–†–ò–ó–û–í–ê–ù -->
        <div th:if="${session.user != null}">
            <section class="profile__title">
                <span>–ü–†–û–§–ò–õ–¨</span>
            </section>

            <section class="profile__panel">
                <!-- –ê–≤–∞—Ç–∞—Ä -->
                <div class="profile__photo-block">
                    <div class="profile__avatar">
                        <img th:if="${session.user.avatar != null and !#strings.isEmpty(session.user.avatar)}"
                             th:src="${session.user.avatar}"
                             alt="–ê–≤–∞—Ç–∞—Ä"
                             class="profile__avatar-img" />

                        <div th:if="${session.user.avatar == null or #strings.isEmpty(session.user.avatar)}"
                             class="profile__avatar-placeholder">üë§</div>
                    </div>

                    <a class="link profile__avatar-link" th:href="@{/users/upload-avatar}">
                        –ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                    </a>
                </div>

                <form class="profile__form" method="post" action="/profile">
                    <!-- –ò–º—è -->
                    <div class="profile-field">
                        <label class="profile-field__name" for="name">–ò–º—è</label>
                        <input
                                class="profile-field__input"
                                id="name"
                                name="name"
                                type="text"
                                th:value="${session.user.name}"
                                required
                        />
                        <div class="profile-field__check"></div>
                    </div>

                    <!-- Email (read-only) -->
                    <div class="profile-field">
                        <label class="profile-field__name" for="email">Email</label>
                        <input
                                class="profile-field__input"
                                id="email"
                                type="email"
                                th:value="${session.user.email}"
                                readonly
                        />
                        <div class="profile-field__check"></div>
                    </div>

                    <!-- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (LocalDate) -->
                    <div class="profile-field">
                        <label class="profile-field__name" for="birth">–†–æ–∂–¥.</label>
                        <input
                                class="profile-field__input"
                                id="birth"
                                name="birth"
                                type="date"
                                th:value="${session.user.birth}"
                        />
                        <div class="profile-field__check"></div>
                    </div>

                    <!-- –í–æ–∑—Ä–∞—Å—Ç (read-only) -->
                    <div class="profile-field">
                        <label class="profile-field__name" for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input
                                class="profile-field__input"
                                id="age"
                                name="age"
                                type="number"
                                min="0"
                                max="120"
                                th:value="${session.user.age}"
                                readonly
                        />
                        <div class="profile-field__check"></div>
                    </div>

                    <div class="profile-field">
                        <label class="profile-field__name" for="visitCount">–í–∏–∑–∏—Ç—ã</label>
                        <input
                                class="profile-field__input"
                                id="visitCount"
                                name="visitCount"
                                type="number"
                                th:value="${session.user.visitCount}"
                                readonly
                                tabindex="-1"
                        />
                        <div class="profile-field__check"></div>
                    </div>


                    <button class="button profile__submit" type="submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>

                    <div class="profile__links">
                        <a class="link" th:href="@{/users/change-password}">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
                        <a class="link"
                           th:if="${session.user.role == 'admin' or session.user.role == 'moderator'}"
                           th:href="@{/news}"
                        >–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</a>
                        <a class="link"
                           th:if="${session.user.role == 'admin'}"
                           th:href="@{/users/admin}"
                        >–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>

                        <a class="link" th:href="@{/main}">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                        <a class="link" th:href="@{/users/logout}">–í—ã–π—Ç–∏</a>
                    </div>
                </form>
            </section>

            <!-- –õ–∞–π–∫–∏ –Ω–∞–¥–æ —Å–≤—è–∑–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö-->
            <section class="likes">
                <div class="likes__title">
                    <span>–í–ê–®–ò –õ–ê–ô–ö–ò</span>
                </div>

                <div class="likes__grid">
                    <div class="like-item" th:each="u : ${likedUsers}">
                        <div class="like-item__inner">
                            <div class="like-item__img">
                                <img th:if="${u.avatar != null and !#strings.isEmpty(u.avatar)}"
                                     th:src="${u.avatar}"
                                     alt="–§–æ—Ç–æ"
                                     style="width:100%; height:100%; object-fit:cover;" />
                                <div th:if="${u.avatar == null or #strings.isEmpty(u.avatar)}"
                                     style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:32px; color:#999;">
                                    üë§
                                </div>
                            </div>

                            <div class="like-item__text" th:text="${u.name} + ', ' + ${u.age} + ' –ª–µ—Ç'">–ò–º—è, 18 –ª–µ—Ç</div>
                        </div>
                    </div>

                    <div th:if="${likedUsers == null or likedUsers.isEmpty()}" class="status__text">
                        –ü–æ–∫–∞ –Ω–µ—Ç –ª–∞–π–∫–æ–≤
                    </div>
                </div>
            </section>
        </div>

    </main>

    <footer class="footer">
        –°–∞–π—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã 24–í–ü1 –ì—Ä–∏–¥–Ω–µ–≤ –í–ª–∞–¥–∏—Å–ª–∞–≤ –∏ –ü–æ–Ω–æ–º–∞—Ä–µ–≤ –ü–∞–≤–µ–ª
    </footer>
</div>

<script src="/js/time_fetcher.js"></script>
</body>
</html>
